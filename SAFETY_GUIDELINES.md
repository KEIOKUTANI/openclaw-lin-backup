# API使用量 安全ガイドライン

## 🚨 重要：20ドルクレジット保護

**残高**: $20 USD
**目標**: 異常消費を防ぎ、安全に使い切る

---

## 📊 使用量制限（自動監視）

### セッションあたり
- **トークン**: 100,000まで（約$0.50）
- **コスト**: $0.50まで
- **目安**: 通常の会話20-30往復

### 1時間あたり
- **トークン**: 200,000まで（約$1.00）
- **コスト**: $1.00まで

### 1日あたり
- **トークン**: 1,000,000まで（約$5.00）
- **コスト**: $5.00まで

→ **$20で約4日間使用可能**

---

## ✅ 安全な使用方法

### 1. 毎回の会話前にチェック
```bash
cd /root/openclaw_data/lin
python3 api_usage_guard.py status
```

### 2. 会話後にもチェック
- 使いすぎていないか確認
- アラートが出ていないか確認

### 3. 避けるべき行動
❌ **長時間の連続会話**（休憩を入れる）
❌ **大量のコード生成**（必要最小限に）
❌ **繰り返しの質問**（まとめて聞く）
❌ **不要なファイル読み込み**（必要なものだけ）

### 4. コスト効率の良い使い方
✅ **質問を簡潔に**
✅ **バッチで処理**（複数タスクをまとめて依頼）
✅ **事前に整理**（何が必要か明確にしてから質問）
✅ **必要な時だけ**（緊急でなければ待つ）

---

## 📈 使用量の目安

| 行動 | トークン数 | コスト |
|------|-----------|--------|
| 短い質問・回答 | 1,000-2,000 | $0.01-0.02 |
| 中程度の会話 | 5,000-10,000 | $0.05-0.10 |
| 長い会話・コード生成 | 20,000-50,000 | $0.20-0.50 |
| 大規模タスク | 100,000+ | $1.00+ |

**このセッション（今）**: 約42,000トークン = $0.20-0.25

---

## 🔔 アラートシステム

### 自動アラート発動条件
1. セッションが$0.50超過
2. 1時間で$1.00超過
3. 1日で$5.00超過

### アラート確認方法
```bash
# 使用状況
python3 api_usage_guard.py status

# アラートファイル
cat /root/openclaw_data/lin/data/usage_alert.txt
```

---

## 💡 推奨スケジュール

### 毎日の使用パターン
- **朝**: チェック + 軽い作業（$0.50以内）
- **昼**: 重めの作業（$1.00-2.00）
- **夜**: チェック + 軽い作業（$0.50以内）

### 週の予算配分
- Week 1: $5 (様子見・調整)
- Week 2: $5 (通常使用)
- Week 3: $5 (通常使用)
- Week 4: $5 (予備）

---

## 🛡️ 異常検知

以下の場合は自動でアラート:

1. **急激な増加**: 1時間で通常の3倍以上
2. **連続エラー**: 同じコマンドの繰り返し
3. **大量ループ**: スクリプトの暴走
4. **制限超過**: 設定した上限を超える

---

## 📝 記録の取り方

### 手動記録（推奨）
毎回の会話後:
```bash
# 例：入力10000トークン、出力5000トークン、コスト$0.15
python3 api_usage_guard.py record 10000 5000 0.15
```

### 自動記録（将来）
OpenClawと統合して自動で記録

---

## 🎯 目標

- **4週間で$20を使い切る** = 1週間$5ペース
- **異常消費ゼロ**
- **アラートに即対応**

---

## 緊急時の対応

もし異常にコストが増えたら:

1. **即座に会話を停止**
2. 使用状況を確認: `python3 api_usage_guard.py status`
3. アラートファイルを確認
4. 原因を特定（ループ？大量生成？）
5. 必要に応じてスクリプト停止: `pkill -f python`

---

**最終更新**: 2026-02-28 20:20 JST
